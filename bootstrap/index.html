<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Keycloak -->
    <script src="keycloak.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
        const keycloak = new Keycloak({
            url: 'http://localhost:8080',
            realm: 'app',
            clientId: 'app',
        });

        keycloak.init({onLoad: 'login-required'})
        .then((authenticated) => {
            if (!authenticated) {
                console.log("User not authenticated - reloading page...");
                window.location.reload()
            } else {
                console.log("User authenticated");

                $("#main").load("main.html");

                console.log("Set up token refresher");
                setInterval(() => {
                    keycloak.updateToken(250)
                    .then(() => {
                        console.log("Token refreshed");
                    })
                    .catch(() => {
                        console.error("Failed to refresh token");
                    })
                }, 250000)
            }
        })
        .catch((error) => {
            console.log("There was a initializing the Keycloak adapter!");
        });
    </script>

    <title>Welcome to App</title>
</head>

<body>

<div id="main"></div>

</body>
</html>
